<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>YunDuo | Log in</title>
<!-- Tell the browser to be responsive to screen width -->
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Font Awesome -->
<link rel="stylesheet" href="../adminlte_files/all.min.css">
<!-- Ionicons -->

<!-- icheck bootstrap -->

<!-- Theme style -->
<link rel="stylesheet" href="../adminlte_files/adminlte.min.css">
<!-- Google Font: Source Sans Pro -->
<link href="../adminlte_files/css.css" rel="stylesheet">
<link rel="stylesheet" href="../adminlte_files/select2.min.css">

</head>
<body class="hold-transition login-page">
	<div class="login-box">
		<div class="login-logo">
			<b>欢迎使用金蝶 K/3 Wise</b>
		</div>
		<!-- /.login-logo -->
		<div class="card">
			<div class="card-body login-card-body">
				<p class="login-box-msg">Sign in to start your session</p>

				<form class="infor" action="/load" method="post">
	                <div class="input-group mb-3" >
		                <select class="form-control zhangtao" name="fAcctID" data-placeholder="请选择账套" style="width: 1%;flex: 1 1 auto;">
		                </select>
		                <div class="input-group-append input-group-text" >
		                  <span class="fa fa-book"></span>
		                </div>
		                <div style = "display:none;" class="tipsDiv input-group divTipsZh">
							<span style="color:red;">请选择账套</span>&nbsp;
						</div>
	                </div>
					<div class="input-group mb-3">
						<input type="email" class="form-control" name="fName" placeholder="用户名">
						<div class="input-group-append input-group-text">
							<span class="fNameTips tipsSpan" style="color:red;">*</span>&nbsp;
							<span class="fa fa-user"></span>
						</div>
						<div style = "display:none;" class="input-group divTipsName">
							<span style="color:red;">请输入用户名</span>&nbsp;
						</div>
					</div>
					<div class="input-group mb-3">
						<input type="password" class="form-control" name="pwd" placeholder="密码">
						<div class="input-group-append input-group-text">
							<span class="pwdTips" style="color:red;">*</span>&nbsp;
							<span class="fas fa-lock"></span>
						</div>
						<div style = "display:none;" class="input-group divTipsPwd">
							<span style="color:red;">请输入密码</span>&nbsp;
						</div>
					</div>
					<div class="row">
						<div class="col-3"></div>
						<div class="col-6">
							<div class="icheck-primary errMsg" style="display:none;color:red;">
								用户名或密码错误 ！
							</div>
						</div>
						<div class="col-8">
							<div class="icheck-primary">
								<input type="checkbox" name="remember" checked="checked" >
								<label > 记住密码 </label>
							</div>
						</div>
						<!-- /.col -->
						<div class="col-4">
							<button type="button" class="load btn btn-primary btn-block btn-flat">
							点击登录</button>
						</div>
						<!-- /.col -->
					</div>
				</form>

				<p class="mb-1">
					<a href="#">忘记密码</a>
				</p>
				<p class="mb-2">
					<a href="" class="text-center">注册新用户</a>
				</p>
			</div>
			<!-- /.login-card-body -->
		</div>
	</div>
	<script src="../js/jquery.min.js"></script>
	<script src="../js/select2.full.min.js"></script>
	<script>
		$(function(){
			var cookArr = document.cookie.split(";");
			$('.wuliao').select2({
				minimumInputLength : 5,
			});
			$("input[name='pwd']").focus(function(){
				$.each(cookArr,function(i,v){
					var arr = v.split("=");
					if(arr[0] == $("input[name='fName']").val()){
						$("input[name='pwd']").val(arr[1]);
						return false;
					}
				});
			});
			$.ajax({
				url:"/getaccs"
				,type:"POST"
				,success:function(data){
					console.info(data);
					$(".zhangtao").empty();
					var text = '<option value="-1" >请选择账套</option>';
					$(".zhangtao").append(text);
					$.each(data,function(i,v){
						console.log(v)
						var text = '<option value="'+v.fAcctID+'" >'+v.fAcctNumber+'|'+v.fAcctName+'</option>';
						$(".zhangtao").append(text);
					});						
				}
				,error:function(msg){
					console.info(msg);
				}
			});
			$('input[name="fName"]').bind("input propertychange",function(event){
			       if($('input[name="fName"]').val()==""){
			    	   if($('.fNameTips').text() == ""){
			    		   $('.fNameTips').text('*');
			    	   }
			       }else{
			    	   $(".fNameTips").empty();
			       }
			});
			$('input[name="pwd"]').bind("input propertychange",function(event){
			       if($('input[name="pwd"]').val()==""){
			    	   if($('.pwdTips').text() == ""){
			    		   $('.pwdTips').text('*');
			    	   }
			       }else{
			    	   $(".pwdTips").empty();
			       }
			});
			$(".load").click(function(){
				var zhang = $("select[name='fAcctID']").val();
				if(zhang == -1){
					$(".divTipsZh").css("display","");
					return false;
				}
				var fName = $('input[name="fName"]').val();
				if(fName == ""){
					$(".divTipsName").css("display","");
					return false;
				}
				var pwd = $('input[name="pwd"]').val();
				if(pwd == ""){
					$(".divTipsPwd").css("display","");
				}
				console.info($(".infor").serialize());
				$.ajax({
					url:"/load"
					,type:"POST"
					,data:$(".infor").serialize()
					,success:function(data){
						data = $.parseJSON(data).data
						if(data.success){
							location.href="/index";
							// location.href="/user";
						}else{
							$(".errMsg").css("display","none");
							$(".tipsDiv").css("display","none");
							$(".tipsSpan").empty();
							$("tipsSpan").append("*");
							$(".errMsg").css("display","");
						}
					}
					,error:function(msg){
						console.info(msg);
					}
				});
			});
		});
	</script>
</body>
</html>
